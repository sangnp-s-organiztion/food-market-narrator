name: Auto PR from develop to release

on:
  pull_request:
    branches:
      - develop
    types: [closed]

jobs:
  create-pr:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Close old PRs from develop to release
        uses: actions/github-script@v7
        with:
          script: |
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: "open",
              base: "release",
              head: context.repo.owner + ":develop"
            });

            for (const pr of prs.data) {
              await github.rest.pulls.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: pr.number,
                state: "closed"
              });
            }

      - name: Create new PR develop -> release
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "Auto PR: develop â†’ release",
              head: "develop",
              base: "release",
              body: "This PR was created automatically after develop was updated."
            });